<section class="mx-5" [ngClass]="isSaving ? 'd-none' : ''">

  <div *ngIf="!appointmentId">
	<h2 class="mt-2">Encontre o paciente</h2>
	<app-search-bar
	  (onSearchInput)="filterPacients($event)"
	  [clearSearch]="clearSearch"
	  [listOfFilteredPacients]="filteredPacients"
	></app-search-bar>

	<div *ngIf="filteredPacients">
	  <h3 class="mt-3" *ngIf="filteredPacients.length > 0">Selecione o Paciente</h3>
	  <ul class="list-group">
		<li
		  *ngFor="let pacient of filteredPacients"
		  class="list-group-item"
		  (click)="onSelectPacient(pacient)">
			{{ pacient.identification.pacientName }}
		</li>
	  </ul>
	</div>
	<hr>
  </div>


  <!-- *ngIf="selectedPacient"-->

  <div *ngIf="selectedPacient">
	<form #newAppointment="ngForm" (ngSubmit)="onSubmitAppointment()">
	  <!--Title and buttons-->
	  <div class="row mt-3">
		<h3 class="col-12 col-md mb-3 mb-md-0">Consulta de
		  {{ selectedPacient.identification.pacientName }}
		</h3>

		<div class="col-12 col-md d-flex p-0 justify-content-center justify-content-lg-end">
		  <button
			type="button"
			[disabled]="newAppointmentRegistration || !newAppointment.valid"
			class="btn btn-warning mx-1" (click)="onEditAppointment()">
			Editar Consulta
		  </button>

		  <button
			type="button"
			class="btn btn-danger mx-1"
			[disabled]="newAppointmentRegistration" (click)="onDeleteAppointment()">
			Deletar Consulta
		  </button>

		  <div
			class="d-flex"
			tooltipPosition="bottom"
			[pTooltip]="(!newAppointment.valid) ?
		  'Preencha todas as informações para cadastrar uma nova consulta' : ''">
			<button
			  type="submit"
			  class="btn btn-success mx-1"
			  [disabled]="!newAppointment.valid || !newAppointmentRegistration">
			  Cadastrar Consulta
			</button>
		  </div>




		</div>
	  </div>
	  <hr>
	  <!--Appointment reason, date and time-->
	  <div class="row m-0 mb-3">
		<div class="col-12 col-md">
		  <label
			for="reason"
			class="form-label">Motivo da Consulta
		  </label>
		  <input
			id="reason"
			name="reason"
			class="form-control"
			type="text"
			[(ngModel)]="appointment.reason"
			required maxlength="64" minlength="8">
		</div>
		<div class="col-12 p-0 col-lg mt-3 mt-lg-0">
		  <div class="row m-0">
			<div class="col-12 col-sm">
			  <label for="appointmentDate" class="form-label">
				Data da Consulta
			  </label>
			  <input
				type="date"
				id="appointmentDate"
				name="appointmentDate"
				class="form-control"
				required
				[(ngModel)]="appointment.date"
			  >
			</div>
			<div class="col-12 col-sm">
			  <label for="appointmentTime" class="form-label">
				Horário
			  </label>
			  <input
				type="time"
				id="appointmentTime"
				name="appointmentTime"
				class="form-control"
				required
				[(ngModel)]="appointment.time"
			  >
			</div>
		  </div>
		</div>
	  </div>
	  <!--Description-->
	  <div class="row m-0 mb-3">
		<div class="col">
		  <label
			for="description"
			class="form-label">
			Descrição do Problema
		  </label>
		  <textarea
			id="description"
			name="description"
			class="form-control"
			required minlength="16" maxlength="1024"
			rows="8"
			[(ngModel)]="appointment.description">
	  </textarea>
		</div>
	  </div>
	  <!--Medications-->
	  <div class="row m-0 mb-3">
		<div class="col">
		  <label
			for="medication"
			class="form-label">
			Medicações
		  </label>
		  <textarea
			id="medication"
			name="medication"
			class="form-control"
			rows="2"
			[(ngModel)]="appointment.medication">
	  </textarea>
		</div>
	  </div>
	  <!--Dosage and Precautions-->
	  <div class="row m-0 mb-3">
		<div class="col">
		  <label
			for="dosage"
			class="form-label">
			Dosagem e Precauções
		  </label>
		  <textarea
			id="dosage"
			name="dosage"
			class="form-control"
			required minlength="16" maxlength="256"
			rows="3"
			[(ngModel)]="appointment.dosageAndPrecautions">
	  </textarea>
		</div>
	  </div>
	  <!--Submit-->

	</form>
  </div>
</section>



<!--Loading-->
<div *ngIf="isSaving" class="text-center mt-5">
  <h2 class="pt-5">Salvando informações no banco de dados</h2>
  <p-progressSpinner styleClass="mt-5"></p-progressSpinner>
</div>

<!--Pacient info confirmation-->
<p-confirmDialog
  header="Confirme as informações da Consulta"
  icon="pi pi-database">
</p-confirmDialog>